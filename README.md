## サービス名 ToneTwo(トーン・ツー)

## サービス内容 気分マッチング型匿名SNS

## サービス概要
- 140字のつぶやき投稿から名詞とポジネガの気分を分析。<br>
(例) 名詞 => プログラミング　ポジネガ => 楽しい / 難しい
- 分析から
**「ほかユーザーの似た投稿」をレコメンド**
として表示しマッチング。一対一で気楽に匿名でやり取りができる。
- **匿名制・気分分析によるユーザーマッチングで心理的安全性の高いSNS**

## このサービスへの思い・作りたい理由
このサービスを作ろうと考えたきっかけは、<br>
- 現在のSNSが評価や承認に重心が傾いていること
- AIによるインスタントな共感が孤立感を高める懸念

の二つの背景からです。

近年のSNSは、いいねやフォロワーなどの数字による評価・比較される側面が強く、<br>
素直な本音をいうことが難しくなっているように感じます。

そのように感じる人がSNSに求めていたのは、不特定多数からの承認というよりも、<br>
「そりゃ大変だわ」「わかる」といった、リアルでは得られなかったささやかな共感、<br>
ネットのどこかにはわかってくれる人がいると知った時の安心感だったではないかとかんがえています。

加えて、対話型AIの出現により、ユーザーの意見に短時間で全肯定することで、<br>
機械的に共感らしさを表現することが可能になりました。<br>
そのような対話型AIによるインスタントな共感は、一時的には救いになり得るとは思います。

しかし、やり取りがAIに偏ることで<br>
「リアルやSNSでは誰も理解してくれない。わかってくれるのはAIだけだ」という感覚が強まり、<br>
結果として虚無感や孤立感を深めてしまう懸念があるのではないかとかんがえています。

そこで、匿名で似た気分の人同士が一対一でフランクにつながれる仕組みをつくって、<br>
2010年代初期のSNS黎明期にあったような<br>
「リアルでは言えないことを気軽に言いいあえる場」<br>
に近い体験を取り戻せるサービスをつくりたいとかんがえました。


そのような背景から、本サービスでは、
**「気分でつながる、ほっと安心できるSNS」**
を目指して開発します。

「今、たまたま似たような気分だった」

それだけで、深い関係を前提にしなくても、<br>
ちょっと弱音を吐いたり、安心して本音を交わせたりできる。

**見知らぬ誰かの気持ちに寄り添ったり、寄り添われたりしながら、一瞬でも気分が楽になる。**<br>
そんな体験を届けるサービスを作りたいです。


## ユーザー層について
- フォロワーやいいね数を気にせず、本音を軽くつぶやきたい人
- 炎上や強い対立が苦手で、落ち着いた場を求めている人
- ポジティブの圧がしんどく、無理に明るくしなくていい場がほしい人
- なんとなく孤独を感じていて、同じ気分の人を見つけたい人

## サービスの差別化ポイント・推しポイント
- 心理的安全性を担保する設計
    1. **匿名＋プロフィールに頼らない** :
        コミュニティやフォロワーではなく、投稿そのものがつながりの中心。
    2. **気分マッチング（名詞＋ポジネガ）**:
        近い気分の投稿がレコメンドされ、共感が起きやすい出会い方ができる。
    3. **一対一・交互返信（連投不可）** :
        返信圧がかかりにくく、やり取りのプレッシャーが生まれない。

## サービスの利用イメージ　(本リリース時の仕様も含む)

**基本体験**
- 140字のつぶやき投稿から名詞とポジネガの気分を分析。<br>
(例) 名詞 => プログラミング　ポジネガ => 楽しい / 難しい
- 分析から
**「ほかユーザーの似た投稿」をレコメンド**
として表示しマッチング。
- 一対一で匿名同士で軽いやり取りができる。
- リプライのやり取りは二人のみが見られる

**投稿**
- テキスト投稿のみ
- ほかユーザーへの表示範囲の設定ができる
    - 「リプライ可 / スタンプ返信のみ」の2軸。
    - ほかユーザーの全体TLに「表示 / 非表示（=ほかユーザーとマッチング時・検索時のみ表示）」の2軸。
- 上記は、投稿時に設定をさくっと変更できる
    - 登録後、ユーザー設定で投稿の表示範囲のデフォルト設定を変更できる

    ~~- なおかつ、ユーザー登録の際に、デフォルト設定を決められる~~=>ユーザーの登録時だとTLの仕様がわからず、登録の障壁になるので削除

**似ている投稿をレコメンド**
- MeCabで投稿内容を形態素解析
- 名詞を抽出
- 動詞・形容詞と否定表現を考慮してポジネガ判定しスコア化
- 名詞 + ポジネガスコアから直近7日間に投稿された投稿日の近いポストを検索
(レコメンドの方式をおすすめTLに集約したので動作の安定性のために直近30日から7日間に変更、実際運用してみて速度に問題ないか調査要)
- ユーザーの投稿の下にレコメンドとして表示
- サービスが軌道にのったら、婉曲表現/皮肉表現なども適切に分析できるようにAIによる高精度のポジネガ分析へ移行

**リプライ**
- 交互に返信できる仕様。リプライの連投は不可。<br>
=> 目的 :
    - 荒らし防止
    - 被リプライ側が明示的なブロックなしでリプライをスルーすることができ、スルーしたときの罪悪感が低くユーザー離れを抑える
    - なお、別投稿でレコメンドされないよう明示的にブロック/通報する機能も存在
- リプライがあった場合、ダッシュボードと登録メールあてに通知<br>
=> プライバシーの観点から、メールには投稿内容は記載せず、返信があったことのみ記載
- 登録後の離脱を防ぐため、初期設定でリプライのメール通知ONにする

**スタンプ**
- 返信の代わりに、スタンプ（Slackのような小さいスタンプ）を押せる
    - ポジティブ投稿　＞　すてき | ほっこり | ファイト！
    - ネガティブ投稿　＞　おつかれさま | 無理しないで | わかる

**全体TL**
- 全体TLは心理的安全性のコンセプトから外れるが、下記の目的のため実装
  - 気分マッチング外でも交流が図れるように設置
- 全体タイムラインの投稿表示はユーザーごとにカスタマイズ可能（TLの画面上でさくっと設定を変えられる）
    - 「すべて表示 / 自分の投稿と似ているもののみ」の2軸。
    - 「すべて / ポジ投稿のみ / ネガ投稿のみ」の3軸。

~~- 新規ユーザーの獲得（登録前にどういう雰囲気のサービスか知るため）~~=>権限（未ログイン/ログイン）の切り分けが複雑になり運用コストが上がるため、MVPでは代わりにLPへ「使い方（3STEP）」を掲載し、登録前に利用イメージが伝わる導線を用意する。

~~なお、コンセプト維持のため全体TL非表示の設定も可~~=>設定が増えて画面がごちゃつく+タブ切替で十分な気がするので一旦保留。要望が多ければ実装。

~~- 「TL自体を表示 / 非表示」の2軸。~~=>前述のとおり

**今日の話題**(本リリース時実装)
- アプリの投稿を活性化させるために、「今日の話題」を毎日提供する（「今年の抱負は？」「好きなお菓子は？」など）
- 登録後の離脱を防ぐため、メール通知で今日のお題をお知らせ。

**検索**(本リリース時実装)
- 投稿文に対する単語検索
- 投稿内容の「すべて / ポジ / ネガ」で絞り込み機能

**メール配信**
- 登録時のメールアドレス確認
- 今日のお題の配信(本リリース時実装)
- リプライの通知

**心理的安全性の維持**
- リプライの連投はシステム上不可にする
- 不快な投稿内容は通報/ユーザーブロック可能
- ミュートワードをユーザーごとに設定できる

**モデレーション**
- 危険ワード（自殺、自傷等）が含まれる場合は投稿をできないようバリデーション。
- 危険ワードを投稿しようとした場合、公式の相談窓口（いのちの電話・よりそいホットライン等）を案内を表示
- リプライのやりとりが閉じられている仕様上、エコーチェンバーが発生しやすいと予想されるので、利用規約で「政治/宗教/医療情報の投稿」は原則禁止と投稿内容についてこちらでは責任を持たないと明示
- 匿名性という仕様上、出会い系としての副次的利用の可能性があるため、利用規約で投稿内容で生じた不利益はこちらで責任を持たないと明示
- 政治/宗教/医療情報/出会い系の投稿に含まれると予想される直接的な単語について投稿をできないようバリデーション

**ヘルプページ/お問い合わせ/通報機能**
- 仕様がやや複雑なので、ヘルプページを設置
- 各機能のページにもホバー/タップで機能の概要がわかるようにヘルプマークを設置する
- サービスお問い合わせフォームを作成し、不具合などを迅速に対処
- 通報の多いユーザーへの強制退会機能

**マネタイズ**(本リリース後実装)
- 将来的に、広告によるマネタイズを検討（ネイティブ広告を優先し、体験を損なわない形を目指す）。
- 審査・運用・実装コストを踏まえ、難しい場合はシンプルなバナー広告も選択肢とする。

## ユーザーの獲得について
- 公式Xアカウントを作成し、X内で本サービスの認知度と信頼度UP
- コアユーザー（２回目のログイン後、複数回の投稿があったユーザー）にXで本サービスを紹介してもらえるようポップアップ通知を定期的に表示
- Xで少額広告でA/Bテストを実施。
- X内の広告でユーザー獲得効果が確認できる+サービスの運用が安定してきたら大規模広告を検討する。


## 機能候補

### MVPで実装する予定の機能
- ユーザー登録機能
- 利用規約 / プライバシーポリシー / サードパーティーライセンスの明示
- 投稿機能
    - 投稿の形態素解析/ポジネガ分析
    - 似ている気分のおすすめTLでレコメンド機能
    - チャット機能
        - メッセージを交互にやり取りできる
- TL機能
    - すべての投稿の表示
    - おすすめ投稿の表示
- マイページ
    - 自投稿の一覧
        - 投稿ごとに設定の変更機能
    - チャット 一覧
    - お問い合わせ（不具合報告フォーム、MVPはGoogleフォームで代用）
- モデレーション
    - 公序良俗にそぐわない投稿へのバリデーション

**本リリースまでに実装**
- ユーザー設定
    - 自投稿のリアクション(リプOKか/スタンプのみか)のデフォルト設定
    - 自投稿の表示範囲（全体TLも含むか/おすすめのみか）のデフォルト設定
    - メール通知のON/OFF設定
    - ミュートワードの設定
    - メールアドレスの変更
    - 退会機能
        - アカウント（メールアドレス）は物理削除
        - 他ユーザーへのリプライを残すため、投稿内容は残す（メールアドレス "deleted+<user_id>@example.invalid" に差し替え）
        - 退会後、一定期間は同一メールで再登録不可
- スタンプ機能(ポスト)
    - ポストにスタンプを返せる。3種類表示され、それぞれ一回まで押せる
    - ポジ/ネガで表示されるスタンプが異なる
- スタンプ機能(チャット)
    - 2種類表示され、どちらか一回しか押せない
    - スタンプ押された場合、チャット終了（どちらもメッセージを送れなくなる）
    - チャットのスタンプは、返信するのは気分的に重いが、軽くお礼はしたいときのためを想定しているのでこの仕様
- ポストとチャットメッセージへのブロック/通報機能
- 管理画面機能
    - 危険ワードの投稿規制
        - 危険ワードは投稿時にブロック/案内
        - 通報された投稿は審査で非表示/措置
        - 通報回数が一定数たまった場合、強制退会
- モデレーション
    - こころの電話等の公式窓口への案内
- 通知機能の実装
- メール配信
    - 登録時のメールアドレス確認
    - リプライの通知メール
- チャット追加機能
    - お気に入りのチャットのピン止め機能
    - チャット履歴削除機能(論理削除でユーザーの画面からのみ不可視にする)
- TL
    - 「すべて/ポジ/ネガ」で絞り込み機能
- 今日のお題の提示 / メール配信
- Googleアナリティクスの実装
- 公式Xアカウントを作成

**本リリース後**
- 投稿内容を分析し、ポジネガ判定の調整/モデレーションを強化
- お問い合わせ内容からヘルプページの拡充
- アンケート投票機能（例：冬に食べたいものといえば？など）
- マネタイズ用の広告の実装
- コアユーザー（２回目のログイン後、複数回の投稿があったユーザー）にXで本サービスを紹介してもらえるようポップアップ通知を定期的に表示
- Xで少額広告でA/Bテスト => 新規ユーザー獲得のための広告
- 負荷増加に合わせてバックグラウンド処理をSidekiqへ移行
- 収益が安定したら、文脈理解（皮肉/婉曲）の精度向上を目的に、将来的にML/LLMの導入を検討

## 使用する技術スタック

| 項目 | 採用技術 |
|------|----------|
| フレームワーク | Ruby on Rails 8 |
| フロント | ERB, Hotwire(Turbo / Stimulus), TailwindCSS, DaisyUI |
| DB | PostgreSQL（開発：Docker / 本番：Render） |
| デプロイ | Render |
| ドメイン | Cloudflare |
| 認証 | Rails標準機能によるパスワード認証 |
| 形態素解析 | MeCab（Natto / NEologd + user.dic） |
| ポジネガ分析 | 日本語評価極性辞書（PN / Wago辞書 + user.pn） |
| レコメンド | ActiveRecord（PostgreSQLを用いた軽量レコメンド） |
| モデレーション | 禁止ワードフィルタ（モデルバリデーション） |
| メール作成/送信 | ActionMailer |
| メール配信基盤 | Resend |
| 非同期ジョブ | Active Job（adapter: :async） |
| 管理画面 | Administrate |
| エラーモニタリング | Renderログ(エラーモニタリングは本リリース以降) |
| セキュリティ | rack-attack（レート制限 / ブルートフォース対策） |
| シークレット検知（CI） | GitGuardian |
| 静的解析 | RuboCop |
| セキュリティ静的解析 | Brakeman |
| テスト | MVPでは最小限（手動確認＋重要箇所のみrequest spec） |
| バージョン管理 | GitHub |
| インフラ補助 | Docker, GitHub Actions |


---

### フレームワーク
- **Ruby on Rails 8**
    - 高速開発・認証、メール、非同期更新、管理画面などSNSに必要な機能を素早く実装できる
    - Rails標準機能を優先して採用し、外部サービスやGemへの依存を最小限にする
        - 認証：Authentication generator（`bin/rails generate authentication`）をベースに実装
        - ジョブ：Active Jobを使用（本リリース以降はSolid Queue等の運用も視野）

---

### フロントエンド
- **Hotwire (Turbo / Stimulus)**
    - ページ全体の再読み込みを避け、必要な部分だけ更新して体験を軽くする
        - 投稿後のレコメンド更新
        - スタンプ押下の反映
        - TL表示の切り替え
- **Tailwind CSS / DaisyUI**
    - 既成コンポーネントを使って、モダンなUIコンポーネントを素早く構築

---

### データベース
- **PostgreSQL**
    - Railsとの相性が良く、トランザクションやインデックスなどRDBとしての基本性能が高い
    - 将来的にAIを導入する際も、ベクトル検索をPostgreSQL拡張で扱えるため、データを分散させずに機能追加しやすい（例：`pgvector`/`pgvector-ruby`）

- **開発：Docker**
    - Docker Compose上でPostgreSQLコンテナを起動
    - 依存関係を固定し、開発環境の再現性を高めるため、DockerによるローカルDBを使用

- **本番：Render**
    - RenderのマネージドPostgreSQLを使用
    - DBのセットアップや保守運用の負担を減らし、安定した運用を行うため
    - （将来）Render上でも`pgvector`を有効化してベクトル検索を扱える構成に拡張可能

---

### デプロイ
- **Render**
    - 過去に利用経験があり、学習コストを抑えてMVPの開発・運用に集中できるため
    - 本番環境はRenderにデプロイし、Web/DBなどをマネージドで運用してインフラ管理の手間を減らす

---

### ドメイン/ DNS・セキュリティ
- **Cloudflare**
    - ドメイン購入〜DNS管理を一元化でき、初期設定で迷いにくい
    - Freeでも DNS / CDN / SSL(TLS) / DDoS対策 など基本機能が揃い、MVPの運用コストを抑えられる
    - 料金体系が明瞭で、必要になったら段階的にプランアップしやすい
    - 将来は Workers + Cron Triggers で、定期処理（例：今日のお題）を定時実行する構成も取れる（無料枠あり）
---

### 認証　
- **Rails標準機能によるパスワード認証**
    - 認証をRails標準機能で実装し、認証まわりの外部Gem依存を最小限にする
        - 実装のブラックボックス化を避け、挙動を追いやすくする
        - 外部Gemは将来的にメンテナンス状況や互換性が変わる可能性があるため、コア機能はフレームワーク標準に寄せて保守性を確保する
---

### 形態素解析
- **MeCab（Natto）**
    - 日本語テキストを形態素に分割し、品詞情報を取得する
    - 名詞抽出（レコメンド）と、動詞・形容詞・否定表現の抽出（ポジネガ分析）の前処理として利用
    - Rubyから扱いやすいように、`MeCab` のラッパーとして `Natto` を採用

- **MeCab-ipadic-NEologd + user.dic（ユーザー辞書）**
    - SNS特有の新語・固有名詞（商品名/店名/流行語など）の分かち書き精度を改善するため、NEologd辞書を利用
    - NEologdでも分割が不自然な語（例：頻出スラング、表記ゆれ等）は user.dic で補強し、解析結果のブレを抑える
    - 追加対象は「頻出」かつ「分析結果に影響が大きい語」に絞り、辞書運用コストを抑える

---

### ポジネガ分析
- **日本語評価極性辞書（東北大学 乾・岡崎研究室）+ user.pn（ユーザー辞書）**
    - 単語ごとの極性（ポジ／ネガ）を定義した辞書を用い、投稿文のポジ／ネガを簡易的に数値化する
    - 形態素解析の結果をもとに、辞書のヒット語の平均値を投稿スコアとして採用
    - 判定は 平均値がマイナスならネガ、0以上ならポジとして振り分ける（MVP時点では二値分類で簡易的に運用）
    - SNSで頻出する語や表記ゆれでヒットしづらい語は`user.pn`で補強し、解析結果のブレを抑える
    - ※辞書ベースのため、皮肉・婉曲表現・文脈依存の解釈には限界がある（本リリース以降の改善対象）

---

### 投稿レコメンド
- **ActiveRecord（PostgreSQLを用いた軽量レコメンド）**
  - `terms / post_terms` に保存した 名詞で一致判定
  - 極性（ポジ/ネガ）*が同じ投稿を対象に絞る
  - **一致名詞数が多い順**にランキング（`ORDER BY match_terms_count DESC`）
  - 同点は **直近投稿優先**（`created_at DESC`）

---

### モデレーション
- **禁止ワードフィルタ（モデルバリデーション）**
    - 投稿内容に対して禁止ワードをチェックし、該当する場合は保存を拒否する（バリデーションエラー）
    - 禁止ワードはDBで管理し、管理画面から追加・変更する運用
    - 対象は「自傷・自殺などの危険ワード」や「公序良俗に反するワード」を想定(
    同一テーブルでカテゴリenumで処理分岐)
    - 自傷・自殺などの危険ワードに該当した場合は、エラーメッセージとあわせて公式の相談窓口（いのちの電話等）への案内を表示する

---

### メール作成/送信
- **ActionMailer**
    - メール本文（件名/本文/テンプレート）を生成し、送信処理を呼び出すために利用
    - 送信は `deliver_later` を基本とし、ユーザー操作のレスポンスを待たせないUX

### メール配信基盤
- **Resend**
    - ActionMailerから受け取ったメールを実際に配送するための配信基盤
    - 配送の信頼性と運用の手間を考慮して採用

### 非同期ジョブ
- **Active Job（adapter: :async）**
    - メール送信などの処理をリクエストとは別に実行するために利用（MVPはリリース速度優先で` :async` での軽量運用）
    - 本リリース以降、信頼性を高めるためSolid Queueをキャッチアップし運用

---

### 管理画面
- **Administrate**
    - 通報管理・禁止ワード管理・ユーザー管理など、運用上必要な管理機能を素早く実装するために採用
    - 運用ルールの変更（禁止ワードの追加等）を画面から即時反映できるようにする

### エラーモニタリング
- **Rails標準のログ出力**
    - MVP段階では Rails標準のログ出力を利用し、運用コストを抑える
    - 利用者増加や再現困難な不具合が増えた段階で、外部モニタリングツール(Sentry等)の導入を検討する

---

### セキュリティ
- **rack-attack**
    - ログイン試行や投稿・リプライ・通報などのリクエストにレート制限をかけ、ブルートフォース攻撃やスパム連打を抑止する
    - 入口側の防御のCloudflareを補完し、rack-attackでアプリ側の防御を実装する

---

### シークレット検知（CI）
- **GitGuardian**
    - APIキーやトークンなどのシークレットが誤ってコミット/Pushされることを検知し、漏洩リスクを早期に防ぐ

### 静的解析（CI）
- **RuboCop**
    - コード規約の統一とLintの検出により品質を安定させる

###  セキュリティ静的解析
- **Brakeman**
    - Railsアプリに特有の脆弱性パターン（SQLインジェクション、XSS等）の検知を行い、リリース前にリスクを潰す

---

###  テスト
- **MVPでは最小限（手動確認＋重要箇所のみrequest spec）**
    - MVP段階では開発スピードを優先し、基本は手動確認で動作を担保する
    - ただし、壊れると致命的な導線（例：ログイン、投稿、リプライ、ミュート、退会など）は `request spec` を最小限だけ用意し、回帰バグを防ぐ

---

### バージョン管理
- **GitHub**
    - コードのバックアップとバージョン管理

---

### インフラ補助
- **Docker**
    - 環境の標準化
- **GitHub Actions**
    - CI（静的解析・テスト等）の自動化
---

## 技術検証リポジトリ（NLP/極性辞書/クエリ検証/Docker構成の試行等）
https://github.com/Iwasaki-Y0125/Rails-v8-sandbox

## 参考
- MeCab公式: https://taku910.github.io/mecab/
- natto（GitHub）: https://github.com/buruzaemon/natto
- mecab-ipadic-neologd(GitHub): https://github.com/neologd/mecab-ipadic-neologd
- 日本語評価極性辞書（東北大学 乾・岡崎研究室）: https://www.cl.ecei.tohoku.ac.jp/Open_Resources-Japanese_Sentiment_Polarity_Dictionary.html
---
- Rails Guides | Sign Up and Settings : https://guides.rubyonrails.org/sign_up_and_settings.html
- Rails 8で基本的な認証ジェネレータが導入される（翻訳）:
https://techracho.bpsinc.jp/hachi8833/2024_10_21/145343
- Rails Guides | Active Job（:async） : https://guides.rubyonrails.org/active_job_basics.html
---
- Render(Deploying) : https://render.com/docs/deploys
- Render(Web Services) : https://render.com/docs/web-services
- Render(Postgresql初期設定) : https://render.com/docs/postgresql-creating-connecting
---
- Cloudflare公式: https://www.cloudflare.com/ja-jp/
- Cron Trigger(Cloudflare Docs): https://developers.cloudflare.com/workers/configuration/cron-triggers/
---
- Resend: https://resend.com/
---
- Turbo Handbook : https://turbo.hotwired.dev/handbook/introduction
- Stimulus Handbook : https://stimulus.hotwired.dev/handbook/introduction
---
- Tailwind Doc : https://tailwindcss.com/docs/installation/using-vite
- DaisyUI Doc :https://daisyui.com/docs/intro/
---
- Administrate : https://github.com/thoughtbot/administrate
- rack-attack : https://github.com/rack/rack-attack
- Brakeman : https://brakemanscanner.org/docs/
- GitGuardian(CI) : https://docs.gitguardian.com/ggshield-docs/reference/secret/scan/ci
