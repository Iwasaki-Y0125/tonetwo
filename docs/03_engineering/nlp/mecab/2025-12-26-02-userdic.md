# MeCabでのユーザー辞書追加方法

## 目的
- MeCabおよびmecab-ipadic-neologd導入後、「うざい」が「う + ざい」に分割される問題が残ったため、ユーザー辞書を追加し改善を図る

## 結論
- ユーザー辞書の登録によって分かち書きが改善できることを確認

## 今後の方針
- 登録は必要な語句に絞る（参照語選定や辞書ビルドが必要で、登録語が増えるほど運用負担が増えるため）
  - Postgresqlでの簡易レコメンド実装際にの1000件のダミーデータでのテストする予定。その際に、SNS上で頻出でポジネガ判定に影響が高そうな語句を精査し登録する
  - 将来的にはAIで形態素解析~ポジネガ判定まで行うため、必要十分の登録にとどめる。

## 変更点
- ユーザー辞書（CSV/DIC）を追加
  - mecab_userdic/user.csv に うざい を形容詞として登録
  - mecab_userdic/user.dic を生成
- Analyzerクラスにneologd+user.dicの参照するように追加
- ユーザー辞書作成・動作確認・トラブルシュート（mecab-dict-indexの場所特定など）のメモを追加(mecab_userdic/README.md)

## 導入手順
`mecab_userdic/README.md`を確認

## 動作確認
- コンテナ内で実行
  - `make exec`
- 分割確認（登録前の挙動）
```sh
BASE_DIC="$(mecab-config --dicdir)/mecab-ipadic-neologd"
echo "うざい" | mecab -d "$BASE_DIC"

# 出力結果
う      感動詞,*,*,*,*,*,う,ウ,ウ
ざい    名詞,一般,*,*,*,*,*
EOS
```

- 参照語の情報取得（連結ID/生起/品詞）
```sh
echo "うっとうしい" | mecab -d "$BASE_DIC" \
  --node-format='%S 連結L=%phl 連結R=%phr 生起=%c 品詞=%H\n' \
  --bos-format='' --eos-format=''

# 出力結果
うっとうしい 連結L=43 連結R=43 生起=6956 品詞=形容詞,自立,*,*,形容詞・イ段,基本形,うっとうしい,ウットウシイ,ウットーシイ
```

- ユーザー辞書反映確認
```sh
echo "うざい" | mecab -d "$BASE_DIC" -u mecab_userdic/user.dic \
  --node-format='%S 連結L=%phl 連結R=%phr 生起=%c 品詞=%H\n' \
  --bos-format='' --eos-format=''

# 出力例
うざい 連結L=43 連結R=43 生起=6956 品詞=形容詞,自立,*,*,形容詞・イ段,基本形,うざい,ウザイ,ウザイ
```

## 補足
- `mecab-dict-index: command not found` の場合は `mecab-config --libexecdir` から実体パスを特定して実行しました。（詳細は`mecab_userdic/README.md`の補足を参照）

## 参考
- MeCab公式: https://taku910.github.io/mecab/
- natto（GitHub）: https://github.com/buruzaemon/natto
- mecab-ipadic-neologd(GitHub):
 https://github.com/neologd/mecab-ipadic-neologd
- 日本語の形態素解析以外にもMeCabを使う、またはMeCabの辞書の仕組み : https://diary.hatenablog.jp/entry/2017/02/04/204344
